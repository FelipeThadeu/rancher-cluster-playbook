- name: Verificar se swap est√° ativa
  command: swapon --summary
  register: swap_status
  changed_when: false
  failed_when: false

- name: Desativar swap imediatamente
  command: swapoff -a
  when: swap_status.stdout != ""
  become: yes

- name: Remover swap do /etc/fstab
  replace:
    path: /etc/fstab
    regexp: '^([^#].*\s+swap\s+)'
    replace: '# \1'
  become: yes
